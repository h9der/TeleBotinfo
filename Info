#This bot is developed by Hayder A.
#Developer Channel | @xlxl9 âœ“.

import telebot
import instaloader
from datetime import datetime
from telebot import types
import requests

token = "8293018809:AAHb0t646Vhd11lztqw1EPgjTQiSXUfOWNM"  #TOKEN
bot = telebot.TeleBot(token)

@bot.message_handler(commands=["start"])
def start(message):
    markup = types.InlineKeyboardMarkup()
    tiktok_button = types.InlineKeyboardButton("- ØªÙŠÙƒØªÙˆÙƒ ğŸ–¤.", callback_data="tiktok")
    instagram_button = types.InlineKeyboardButton("- Ø¥Ù†Ø³ØªØºØ±Ø§Ù… ğŸ©·.", callback_data="instagram")
    developer_channel_button = types.InlineKeyboardButton("- Ù‚Ù†Ø§Ø© Ø§Ù„Ù…Ø·ÙˆØ± ğŸ§‘ğŸ»â€ğŸ’».", url="https://t.me/xlxl9")
    markup.add(tiktok_button, instagram_button)
    markup.add(developer_channel_button)
    bot.reply_to(message, "*- Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ Ø¹Ø²ÙŠØ²ÙŠ ÙÙŠ Ø¨ÙˆØª Ù…Ø¹Ø±ÙØ© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ âœ…\n\n- Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯Ù‡ Ù…Ù† Ø§Ù„Ø§Ø³ÙÙ„ Ù„Ø¨Ø¯Ø¡ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ğŸ”¥ .*", parse_mode='Markdown',reply_markup=markup)

@bot.callback_query_handler(func=lambda call: call.data in ["tiktok", "instagram"])
def platform_callback(call):
    chat_id = call.message.chat.id
    if call.data == "tiktok":
        bot.send_message(chat_id, "*- Ø­Ø³Ù†Ø§Ù‹ ÙŠØ±Ø¬Ù‰ Ø§Ø±Ø³Ø§Ù„ ÙŠÙˆØ²Ø± Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¹Ù„Ù‰ Ø§Ù„ØªÙŠÙƒØªÙˆÙƒ Ù„Ø§Ø±Ø³Ø§Ù„ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªØ© Ø§Ù„ÙŠÙƒ âœ…*",parse_mode='Markdown')
    elif call.data == "instagram":
        bot.send_message(chat_id, "*- Ø­Ø³Ù†Ø§Ù‹ ÙŠØ±Ø¬Ù‰ Ø§Ø±Ø³Ø§Ù„ ÙŠÙˆØ²Ø± Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ù†Ø³ØªØºØ±Ø§Ù… Ù„Ø§Ø±Ø³Ø§Ù„ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªØ© Ø§Ù„ÙŠÙƒ âœ…*",parse_mode='Markdown')
    bot.register_next_step_handler(call.message, process_username, call.data)

def process_username(message, platform):
    chat_id = message.chat.id
    username = message.text

    if platform == "tiktok":
        url = requests.get(f'https://tiktokinfo--jts5.repl.co/TikTok-info?username={username}').text
        bot.send_message(chat_id, url)
    elif platform == "instagram":
        Lev = instaloader.Instaloader()
        profile = instaloader.Profile.from_username(Lev.context, username)
        
        name = profile.full_name
        fols = profile.followers
        folg = profile.followees
        bio = profile.biography
        pr = profile.is_private
        pic = profile.profile_pic_url
        
        external_url = profile.external_url
        
        response = requests.get(f"https://www.instagram.com/{username}/?__a=1")
        try:
            response_json = response.json()
            created_at = datetime.fromtimestamp(response_json["graphql"]["user"]["created_at"]).strftime('%Y-%m-%d %H:%M:%S')
        except (requests.exceptions.JSONDecodeError, KeyError):
            created_at = "ØºÙŠØ± Ù…ØªØ§Ø­"
        
        info_message = (f"Ø§Ù„Ø§Ø³Ù…: {name}\nÙ…ØªØ§Ø¨Ø¹ÙŠÙ†: {fols}\nØ®Ø§Øµ: {pr}\nÙ…ØªØ§Ø¨Ø¹Ø©: {folg}\nÙ†Ø¨Ø°Ø©: {bio}\nØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: {created_at}")
        bot.send_photo(chat_id, pic, info_message)

print('- @xlxl9 âœ“')
#This bot is developed by Hayder.A
#Developer Channel | @xlxl9 âœ“.

bot.polling()
